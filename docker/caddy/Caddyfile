{
  email admin@raashed.xyz

  # Restrict on-demand certificate issuance to verified status domains.
  on_demand_tls {
    ask http://127.0.0.1:3000/api/tls/ask
    interval 2m
    burst 10
  }
}

uptique.raashed.xyz {
  reverse_proxy 127.0.0.1:3000 {
    header_up Host {host}
    header_up X-Forwarded-Host {host}
    header_up X-Forwarded-Proto {scheme}
  }
}

uptique-server.raashed.xyz {
  reverse_proxy 127.0.0.1:8084 {
    header_up Host {host}
    header_up X-Forwarded-Host {host}
    header_up X-Forwarded-Proto {scheme}
  }
}

# Catch-all HTTPS entrypoint for verified customer status domains.
:443 {
  tls {
    on_demand
  }

  reverse_proxy 127.0.0.1:3000 {
    header_up Host {host}
    header_up X-Forwarded-Host {host}
    header_up X-Forwarded-Proto {scheme}
  }
}

# Redirect plain HTTP to HTTPS.
:80 {
  redir https://{host}{uri} permanent
}
